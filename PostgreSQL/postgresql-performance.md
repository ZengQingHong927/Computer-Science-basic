# PostgreSQL - Optimise
## SQL語句查詢優化
1. 使用explain/analyze分析查詢計畫，在查詢條件使用的列上創建索引。
2. 優化子查詢：執行子查詢時數據庫需要為內部嵌套語句查詢結果建立一個臨時表，再使用臨時表的數據進行查詢。查詢完在刪除臨時表。可以使用join語句替換子查詢，join語句不需建立臨時表。
例如：  
select * from a1 where a1.id in (select b1.a1_id from b1) ===  
select a1.* from a1 inner join b1 on a1.id=b1.a1_id  
查看第一步的分析結果，在查詢條件使用的列上創建索引  
索引的使用  
- 主鍵（默認是自帶索引）和外鍵（一些可以跟其他表關聯的字段）
- where 字句經常出現的字段
- 索引應該建在小字段上，大數據字段（bit,image,text,blob...）不適用  
聯合索引（複合索引）
只要列中包含有NULL值都不會被包含在索引中，複合索引中只要有一列含有NULL值，那麼這一列對於此複合索引就是無效的，所以我們在數據庫設計時不要讓屬性的默認值為NULL.  

## 表的優化
1. 字段很多的表分成多個表
2. 關係表
3. 適當增加冗余字段
4. 優化插入記錄速度
插入記錄時，影響速度的主要是索引，唯一性校驗，一次性插入條數
5. 插入大量數據時先刪除索引，完成後再創建索引